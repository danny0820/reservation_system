# AppointmentServicesã€Orderã€Order_detail å’Œ Coupon API è¨­è¨ˆè¨ˆåŠƒ

## ç³»çµ±æ¦‚è¿°
è¨­è¨ˆå››å€‹æ–°æ¨¡çµ„çš„å®Œæ•´ APIï¼Œéµå¾ªç¾æœ‰ç³»çµ±çš„æ¶æ§‹æ¨¡å¼ï¼š
- AppointmentServicesï¼ˆé ç´„æœå‹™é—œè¯ï¼‰
- Orderï¼ˆè¨‚å–®ç®¡ç†ï¼‰
- Order_detailï¼ˆè¨‚å–®æ˜ç´°ï¼‰
- Couponï¼ˆå„ªæƒ åˆ¸ç³»çµ±ï¼‰

## æ¶æ§‹è¨­è¨ˆ

### 1. è³‡æ–™åº«æ¨¡å‹ (Models)

**a) AppointmentServices æ¨¡å‹**
- å¤šå°å¤šé—œè¯è¡¨ï¼ˆé ç´„ â†” æœå‹™ï¼‰
- è¤‡åˆä¸»éµè¨­è¨ˆ (appointment_id, product_id)
- ç´šè¯åˆªé™¤æ”¯æ´

**b) Order æ¨¡å‹**
- å®Œæ•´è¨‚å–®è³‡è¨Š
- ç‹€æ…‹ç®¡ç†ç³»çµ± (pending/confirmed/paid/completed/cancelled)
- é ç´„é—œè¯ï¼ˆå¯é¸ï¼‰
- å„ªæƒ åˆ¸ä½¿ç”¨è¨˜éŒ„

**c) Order_detail æ¨¡å‹**
- è¨‚å–®æ˜ç´°é …ç›®
- å•†å“æ•¸é‡å’Œåƒ¹æ ¼è¨˜éŒ„
- å®¢è£½åŒ–å‚™è¨»

**d) Coupon æ¨¡å‹**
- å„ªæƒ åˆ¸åŸºæœ¬è³‡è¨Š
- æŠ˜æ‰£é¡å‹å’Œæ•¸å€¼
- æœ‰æ•ˆæœŸé™ç®¡ç†
- ä½¿ç”¨ç‹€æ…‹è¿½è¹¤

### 2. é©—è­‰æ¨¡å‹ (Schemas)

**AppointmentServices Schemas:**
- `AppointmentServiceCreate` - æ–°å¢æœå‹™åˆ°é ç´„
- `AppointmentServiceResponse` - é ç´„æœå‹™è©³æƒ…
- `AppointmentServicesCalculation` - æ™‚é–“å’Œè²»ç”¨è¨ˆç®—

**Order Schemas:**
- `OrderCreate` - å‰µå»ºè¨‚å–®ï¼ˆå«å„ªæƒ åˆ¸ï¼‰
- `OrderUpdate` - è¨‚å–®æ›´æ–°
- `OrderResponse` - è¨‚å–®è©³æƒ…å›æ‡‰
- `OrderStatusUpdate` - ç‹€æ…‹æ›´æ–°
- `OrderSummary` - è¨‚å–®æ‘˜è¦

**Order_detail Schemas:**
- `OrderDetailCreate` - æ–°å¢è¨‚å–®é …ç›®
- `OrderDetailUpdate` - æ›´æ–°é …ç›®
- `OrderDetailResponse` - é …ç›®è©³æƒ…

**Coupon Schemas:**
- `CouponCreate` - å‰µå»ºå„ªæƒ åˆ¸
- `CouponUpdate` - æ›´æ–°å„ªæƒ åˆ¸
- `CouponResponse` - å„ªæƒ åˆ¸è©³æƒ…
- `CouponValidation` - å„ªæƒ åˆ¸é©—è­‰
- `CouponUsage` - ä½¿ç”¨è¨˜éŒ„

### 3. CRUD å±¤å¯¦ä½œ

**AppointmentServices CRUDï¼š**
- æ–°å¢/ç§»é™¤æœå‹™é …ç›®åˆ°é ç´„
- æŸ¥è©¢é ç´„çš„æ‰€æœ‰æœå‹™
- è¨ˆç®—é ç´„ç¸½æ™‚é–“å’Œè²»ç”¨
- é©—è­‰æœå‹™é …ç›®æœ‰æ•ˆæ€§

**Order CRUDï¼š**
- è¨‚å–®ç”Ÿå‘½é€±æœŸç®¡ç†
- ç‹€æ…‹è½‰æ›é‚è¼¯é©—è­‰
- ä»˜æ¬¾ç‹€æ…‹è¿½è¹¤
- å„ªæƒ åˆ¸æ‡‰ç”¨å’Œé©—è­‰
- è¨‚å–®é‡‘é¡è¨ˆç®—ï¼ˆå«æŠ˜æ‰£ï¼‰

**Order_detail CRUDï¼š**
- è¨‚å–®é …ç›®ç®¡ç†
- åº«å­˜æª¢æŸ¥å’Œæ‰£æ¸›
- åƒ¹æ ¼è¨ˆç®—å’Œé©—è­‰
- é …ç›®æ•¸é‡èª¿æ•´

**Coupon CRUDï¼š**
- å„ªæƒ åˆ¸ç”Ÿå‘½é€±æœŸç®¡ç†
- æœ‰æ•ˆæœŸé™æª¢æŸ¥
- ä½¿ç”¨æ¢ä»¶é©—è­‰
- æŠ˜æ‰£è¨ˆç®—é‚è¼¯
- ä½¿ç”¨æ¬¡æ•¸è¿½è¹¤

### 4. API è·¯ç”±è¨­è¨ˆ

**AppointmentServices è·¯ç”± (`/appointment-services`)ï¼š**
- `GET /appointments/{appointment_id}/services` - ç²å–é ç´„æœå‹™
- `POST /appointments/{appointment_id}/services` - æ–°å¢æœå‹™åˆ°é ç´„
- `DELETE /appointments/{appointment_id}/services/{product_id}` - ç§»é™¤æœå‹™
- `GET /appointments/{appointment_id}/calculation` - ç²å–é ç´„è²»ç”¨è¨ˆç®—

**Order è·¯ç”± (`/orders`)ï¼š**
- `GET /orders/` - ç²å–è¨‚å–®åˆ—è¡¨ï¼ˆåˆ†é ã€ç¯©é¸ï¼‰
- `POST /orders/` - å‰µå»ºæ–°è¨‚å–®ï¼ˆæ”¯æ´å„ªæƒ åˆ¸ï¼‰
- `GET /orders/{order_id}` - ç²å–è¨‚å–®è©³æƒ…
- `PATCH /orders/{order_id}/status` - æ›´æ–°è¨‚å–®ç‹€æ…‹
- `GET /orders/user/{user_id}` - ç”¨æˆ¶è¨‚å–®æŸ¥è©¢
- `POST /orders/{order_id}/apply-coupon` - æ‡‰ç”¨å„ªæƒ åˆ¸
- `DELETE /orders/{order_id}/coupon` - ç§»é™¤å„ªæƒ åˆ¸

**Order_detail è·¯ç”± (`/order-details`)ï¼š**
- `GET /orders/{order_id}/details` - ç²å–è¨‚å–®æ˜ç´°
- `POST /orders/{order_id}/details` - æ–°å¢è¨‚å–®é …ç›®
- `PATCH /orders/{order_id}/details/{detail_id}` - æ›´æ–°é …ç›®
- `DELETE /orders/{order_id}/details/{detail_id}` - åˆªé™¤é …ç›®

**Coupon è·¯ç”± (`/coupons`)ï¼š**
- `GET /coupons/` - ç²å–å„ªæƒ åˆ¸åˆ—è¡¨ï¼ˆç®¡ç†å“¡ï¼‰
- `POST /coupons/` - å‰µå»ºæ–°å„ªæƒ åˆ¸ï¼ˆç®¡ç†å“¡ï¼‰
- `GET /coupons/{coupon_id}` - ç²å–å„ªæƒ åˆ¸è©³æƒ…
- `PATCH /coupons/{coupon_id}` - æ›´æ–°å„ªæƒ åˆ¸ï¼ˆç®¡ç†å“¡ï¼‰
- `DELETE /coupons/{coupon_id}` - åˆªé™¤å„ªæƒ åˆ¸ï¼ˆç®¡ç†å“¡ï¼‰
- `POST /coupons/validate` - é©—è­‰å„ªæƒ åˆ¸æœ‰æ•ˆæ€§
- `GET /coupons/available` - ç²å–å¯ç”¨å„ªæƒ åˆ¸ï¼ˆç”¨æˆ¶ï¼‰

### 5. æ¬Šé™æ§åˆ¶

**AppointmentServicesï¼š**
- å®¢æˆ¶ï¼šæŸ¥çœ‹å’Œä¿®æ”¹è‡ªå·±çš„é ç´„æœå‹™
- è¨­è¨ˆå¸«ï¼šæŸ¥çœ‹å’Œä¿®æ”¹è² è²¬çš„é ç´„æœå‹™
- ç®¡ç†å“¡ï¼šå®Œæ•´æ¬Šé™

**Orderï¼š**
- å®¢æˆ¶ï¼šå‰µå»ºå’ŒæŸ¥çœ‹è‡ªå·±çš„è¨‚å–®
- è¨­è¨ˆå¸«ï¼šæŸ¥çœ‹ç›¸é—œé ç´„çš„è¨‚å–®
- ç®¡ç†å“¡ï¼šå®Œæ•´è¨‚å–®ç®¡ç†æ¬Šé™

**Couponï¼š**
- å®¢æˆ¶ï¼šæŸ¥çœ‹å¯ç”¨å„ªæƒ åˆ¸ã€é©—è­‰å„ªæƒ åˆ¸
- è¨­è¨ˆå¸«ï¼šæŸ¥çœ‹å„ªæƒ åˆ¸è³‡è¨Š
- ç®¡ç†å“¡ï¼šå®Œæ•´å„ªæƒ åˆ¸ç®¡ç†æ¬Šé™

### 6. æ¥­å‹™é‚è¼¯äº®é»

**é ç´„æœå‹™ç®¡ç†ï¼š**
- è‡ªå‹•è¨ˆç®—æœå‹™ç¸½æ™‚é–“å’Œé ä¼°è²»ç”¨
- æœå‹™è¡çªæª¢æ¸¬ï¼ˆæ™‚é–“é‡ç–Šï¼‰
- è¨­è¨ˆå¸«å¯ç”¨æ€§é©—è­‰

**è¨‚å–®è™•ç†ï¼š**
- é ç´„èˆ‡è¨‚å–®çš„é—œè¯ç®¡ç†
- å„ªæƒ åˆ¸è‡ªå‹•æ‡‰ç”¨å’Œé©—è­‰
- åº«å­˜ç®¡ç†å’Œå•†å“æ‰£æ¸›
- è¨‚å–®ç‹€æ…‹è‡ªå‹•åŒ–è¿½è¹¤

**å„ªæƒ åˆ¸ç³»çµ±ï¼š**
- å¤šç¨®æŠ˜æ‰£é¡å‹ï¼ˆç™¾åˆ†æ¯”ã€å›ºå®šé‡‘é¡ï¼‰
- æœ‰æ•ˆæœŸé™è‡ªå‹•æª¢æŸ¥
- ä½¿ç”¨æ¢ä»¶é©—è­‰ï¼ˆæœ€ä½æ¶ˆè²»ã€å•†å“é¡å‹ï¼‰
- ä½¿ç”¨æ¬¡æ•¸é™åˆ¶ç®¡ç†

### 7. æ¸¬è©¦ç­–ç•¥ (TDD)

**å–®å…ƒæ¸¬è©¦ï¼š**
- CRUD æ“ä½œæ¸¬è©¦ï¼ˆæ¯å€‹æ¨¡çµ„ï¼‰
- æ¥­å‹™é‚è¼¯æ¸¬è©¦ï¼ˆè¨ˆç®—ã€é©—è­‰ï¼‰
- å„ªæƒ åˆ¸é‚è¼¯æ¸¬è©¦
- ç‹€æ…‹è½‰æ›æ¸¬è©¦

**é›†æˆæ¸¬è©¦ï¼š**
- API ç«¯é»å®Œæ•´æµç¨‹æ¸¬è©¦
- é ç´„â†’æœå‹™â†’è¨‚å–®â†’ä»˜æ¬¾æµç¨‹
- å„ªæƒ åˆ¸æ‡‰ç”¨å®Œæ•´æµç¨‹
- æ¬Šé™æ§åˆ¶æ¸¬è©¦

**è¦†è“‹ç‡ç›®æ¨™ï¼š88%**

### 8. æ–‡ä»¶çµæ§‹
```
app/models/
â”œâ”€â”€ appointment_models.py
â”œâ”€â”€ order_models.py
â””â”€â”€ coupon_models.py

app/schemas/
â”œâ”€â”€ appointment_schemas.py
â”œâ”€â”€ order_schemas.py
â””â”€â”€ coupon_schemas.py

app/crud/
â”œâ”€â”€ appointment_crud.py
â”œâ”€â”€ order_crud.py
â””â”€â”€ coupon_crud.py

app/routers/
â”œâ”€â”€ appointments.py
â”œâ”€â”€ orders.py
â””â”€â”€ coupons.py

tests/unit/
â”œâ”€â”€ test_appointments.py
â”œâ”€â”€ test_orders.py
â””â”€â”€ test_coupons.py

tests/integration/
â”œâ”€â”€ test_appointment_order_integration.py
â””â”€â”€ test_coupon_integration.py
```

### 9. å¯¦ä½œé †åº
1. **ç¬¬ä¸€éšæ®µ**ï¼šAppointmentServices æ¨¡çµ„
   - æ¨¡å‹ â†’ Schema â†’ CRUD â†’ è·¯ç”± â†’ æ¸¬è©¦

2. **ç¬¬äºŒéšæ®µ**ï¼šCoupon æ¨¡çµ„
   - æ¨¡å‹ â†’ Schema â†’ CRUD â†’ è·¯ç”± â†’ æ¸¬è©¦

3. **ç¬¬ä¸‰éšæ®µ**ï¼šOrder å’Œ Order_detail æ¨¡çµ„
   - æ¨¡å‹ â†’ Schema â†’ CRUD â†’ è·¯ç”± â†’ æ¸¬è©¦
   - æ•´åˆå„ªæƒ åˆ¸é‚è¼¯

4. **ç¬¬å››éšæ®µ**ï¼šæ•´åˆæ¸¬è©¦å’Œå„ªåŒ–
   - é›†æˆæ¸¬è©¦
   - æ€§èƒ½å„ªåŒ–
   - æ›´æ–°ä¸»æ‡‰ç”¨è¨»å†Šè·¯ç”±

### 10. ç‰¹æ®ŠåŠŸèƒ½è¨­è¨ˆ

**è¨‚å–®èˆ‡é ç´„æ•´åˆï¼š**
- å¾é ç´„è‡ªå‹•ç”Ÿæˆè¨‚å–®
- é ç´„æœå‹™è‡ªå‹•åŠ å…¥è¨‚å–®æ˜ç´°
- è¨‚å–®ç‹€æ…‹å½±éŸ¿é ç´„ç‹€æ…‹

**å„ªæƒ åˆ¸é«˜ç´šåŠŸèƒ½ï¼š**
- æ‰¹é‡ç”Ÿæˆå„ªæƒ åˆ¸
- å„ªæƒ åˆ¸ä½¿ç”¨çµ±è¨ˆå ±è¡¨
- è‡ªå‹•éæœŸè™•ç†
- ç‰¹å®šç”¨æˆ¶ç¾¤çµ„å„ªæƒ åˆ¸

æ­¤è¨­è¨ˆæä¾›å®Œæ•´çš„é ç´„ã€è¨‚å–®å’Œå„ªæƒ åˆ¸ç®¡ç†åŠŸèƒ½ï¼Œæ”¯æ´ç¾é«®é ç´„ç³»çµ±çš„æ‰€æœ‰å•†æ¥­éœ€æ±‚ï¼Œä¸¦ä¿æŒèˆ‡ç¾æœ‰ç³»çµ±çš„ä¸€è‡´æ€§ã€‚

## é–‹ç™¼é€²åº¦è¿½è¹¤

### å·²å®Œæˆä»»å‹™
- âœ… è¨ˆåŠƒè¨­è¨ˆå’Œæ–‡æª”å‰µå»º

### é€²è¡Œä¸­ä»»å‹™
- ğŸ”„ å‰µå»º AppointmentServices è³‡æ–™åº«æ¨¡å‹

### å¾…å®Œæˆä»»å‹™
- â³ å‰µå»º Order å’Œ Order_detail è³‡æ–™åº«æ¨¡å‹
- â³ å‰µå»º Coupon è³‡æ–™åº«æ¨¡å‹
- â³ è¨­è¨ˆæ‰€æœ‰é©—è­‰æ¨¡å‹ (Schemas)
- â³ å¯¦ä½œ CRUD æ“ä½œ
- â³ å»ºç«‹ API è·¯ç”±
- â³ æ’°å¯«å–®å…ƒæ¸¬è©¦å’Œé›†æˆæ¸¬è©¦
- â³ ç³»çµ±æ•´åˆå’Œå„ªåŒ–